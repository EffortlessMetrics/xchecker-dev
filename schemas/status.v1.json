{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://xchecker.dev/schemas/status.v1.json",
  "title": "XChecker Status Schema v1",
  "description": "Status output format for xchecker spec execution state",
  "type": "object",
  "required": [
    "schema_version",
    "emitted_at",
    "runner",
    "fallback_used",
    "canonicalization_version",
    "canonicalization_backend",
    "artifacts",
    "last_receipt_path",
    "effective_config"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1",
      "description": "Schema version for this status format"
    },
    "emitted_at": {
      "type": "string",
      "format": "date-time",
      "description": "RFC3339 UTC timestamp when the status was emitted"
    },
    "runner": {
      "type": "string",
      "enum": ["native", "wsl"],
      "description": "Runner mode used for Claude CLI execution"
    },
    "runner_distro": {
      "type": ["string", "null"],
      "description": "WSL distribution name if runner is wsl"
    },
    "fallback_used": {
      "type": "boolean",
      "description": "Whether fallback to text format was used"
    },
    "canonicalization_version": {
      "type": "string",
      "description": "Version of the canonicalization algorithm used"
    },
    "canonicalization_backend": {
      "type": "string",
      "description": "Backend used for canonicalization (e.g., jcs-rfc8785)"
    },
    "artifacts": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["path", "blake3_first8"],
        "properties": {
          "path": {
            "type": "string",
            "description": "Path to the artifact"
          },
          "blake3_first8": {
            "type": "string",
            "pattern": "^[0-9a-f]{8}$",
            "description": "First 8 characters of BLAKE3 hash"
          }
        },
        "additionalProperties": true
      },
      "description": "Artifacts with path and blake3_first8 (sorted by path)"
    },
    "last_receipt_path": {
      "type": "string",
      "description": "Path to the last receipt file"
    },
    "effective_config": {
      "type": "object",
      "additionalProperties": {
        "type": "object",
        "required": ["value", "source"],
        "properties": {
          "value": {
            "description": "The configuration value (arbitrary JSON)"
          },
          "source": {
            "type": "string",
            "enum": ["cli", "config", "programmatic", "default"],
            "description": "Source of this configuration value"
          }
        },
        "additionalProperties": true
      },
      "description": "Effective configuration with source attribution"
    },
    "lock_drift": {
      "type": ["object", "null"],
      "properties": {
        "model_full_name": {
          "type": ["object", "null"],
          "required": ["locked", "current"],
          "properties": {
            "locked": {
              "type": "string",
              "description": "Value from lockfile"
            },
            "current": {
              "type": "string",
              "description": "Current value"
            }
          },
          "additionalProperties": true
        },
        "claude_cli_version": {
          "type": ["object", "null"],
          "required": ["locked", "current"],
          "properties": {
            "locked": {
              "type": "string",
              "description": "Value from lockfile"
            },
            "current": {
              "type": "string",
              "description": "Current value"
            }
          },
          "additionalProperties": true
        },
        "schema_version": {
          "type": ["object", "null"],
          "required": ["locked", "current"],
          "properties": {
            "locked": {
              "type": "string",
              "description": "Value from lockfile"
            },
            "current": {
              "type": "string",
              "description": "Current value"
            }
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": true,
      "description": "Lock drift information if lockfile exists"
    },
    "pending_fixups": {
      "type": ["object", "null"],
      "properties": {
        "targets": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of target files with pending fixups"
        },
        "est_added": {
          "type": "integer",
          "minimum": 0,
          "description": "Estimated number of lines to be added"
        },
        "est_removed": {
          "type": "integer",
          "minimum": 0,
          "description": "Estimated number of lines to be removed"
        }
      },
      "additionalProperties": true,
      "description": "Summary of pending fixups (counts only)"
    }
  },
  "additionalProperties": true
}
